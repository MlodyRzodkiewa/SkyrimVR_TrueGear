cmake_minimum_required(VERSION 3.20)

project(TrueGearPluginVR LANGUAGES CXX)

# =====================================================================
# C++ CONFIG
# =====================================================================
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Wymagane przez fmt/spdlog + ogólna sanity /utf-8
add_compile_options("$<$<CXX_COMPILER_ID:MSVC>:/utf-8>")

# =====================================================================
# VCPKG TOOLCHAIN
# =====================================================================
if(NOT DEFINED CMAKE_TOOLCHAIN_FILE)
    set(CMAKE_TOOLCHAIN_FILE "C:/Repos/VCPKG/scripts/buildsystems/vcpkg.cmake"
        CACHE STRING "" FORCE)
endif()

# =====================================================================
# VCPKG PACKAGES
# =====================================================================
find_package(spdlog CONFIG REQUIRED)
find_package(fmt CONFIG REQUIRED)

message(STATUS "Boost found at: ${Boost_INCLUDE_DIRS}")

# =====================================================================
# WEBSOCKETPP (header-only, ręcznie)
# =====================================================================
add_library(websocketpp INTERFACE)

target_include_directories(websocketpp INTERFACE
    "${CMAKE_SOURCE_DIR}/extern/websocketpp"
)


# =====================================================================
# OPENVR (headers only)
# CommonLibVR też tego wymaga
# =====================================================================
set(OPENVR_INCLUDE_DIR "${CMAKE_SOURCE_DIR}/extern/openvr/headers")

# =====================================================================
# CommonLibVR (w trybie SkyrimVR)
# =====================================================================
set(BUILD_SKYRIMVR ON CACHE BOOL "" FORCE)

# Disable tests for binary_io (otherwise it requires Catch2)
set(BINARY_IO_BUILD_TESTS OFF CACHE BOOL "Disable binary_io tests" FORCE)
set(BUILD_TESTING OFF CACHE BOOL "Disable global testing" FORCE)

add_subdirectory(${CMAKE_SOURCE_DIR}/extern/binary_io)
add_subdirectory(extern/CommonLibVR)

# ==== BOOST (LOCAL HEADER-ONLY) ====
set(BOOST_ROOT "${CMAKE_CURRENT_SOURCE_DIR}/extern/boost")
set(Boost_INCLUDE_DIR "${BOOST_ROOT}")
include_directories(${Boost_INCLUDE_DIR})


# =====================================================================
# TrueGearPluginVR.dll
# =====================================================================
add_library(TrueGearPluginVR SHARED
    src/TrueGearPlugin.cpp
    src/TrueGearWebsocket.cpp
    src/EffectDatabase.cpp
)

target_compile_definitions(TrueGearPluginVR PRIVATE
    SKYRIMVR
    _SKYRIMVR
    SKSE_SUPPORT_XBYAK
)

target_include_directories(TrueGearPluginVR PRIVATE
    "${CMAKE_SOURCE_DIR}/include"
    "${OPENVR_INCLUDE_DIR}"
)

target_link_libraries(TrueGearPluginVR PRIVATE
    CommonLibVR
    websocketpp
    spdlog::spdlog
    fmt::fmt
)

# =====================================================================
# OUTPUT SETTINGS
# =====================================================================
set_target_properties(TrueGearPluginVR PROPERTIES
    OUTPUT_NAME "TrueGearPluginVR"
    PREFIX ""
)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin")
